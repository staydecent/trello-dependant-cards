<html>
<head>
  <script src="https://trello.com/power-ups/power-up.min.js"></script>
  <script src="https://cdn.jsdelivr.net/riot/2.6/riot+compiler.min.js"></script>
  <link rel="stylesheet" href="https://trello.com/power-ups/power-up.css"/>
  <script>
    function attachNew () {
      return t.attach({ url: 'https://trello.com/' })
    }
  </script>
</head>
<body>
  <div id="page">
    <card-search></card-search>
  </div>

  <script type="riot/tag">
    <card-search>
      <div each={ items }>
        <h3>{ name }</h3>
      </div>

      var t = TrelloPowerUp.iframe()
      var cards // will be hoisted

      // Kinda seems hackish, is there a better API to obtain this?
      var currentCardId = t.args[0].context.card

      console.log('currentCardId', currentCardId)

      this.items = []

      t
        .cards('id', 'name', 'url')
        .then(function cardResults(results) {
          cards = results
          this.items = results.filter(notId(currentCardId))
          console.log('this.items', this.items)
        })

      function notId (id) {
        return function (item) {
          return item.id !== id
        }
      }

      function pluck (key) {
        return function (item) {
          return item[key]
        }
      }

      function truthy (item) {
        return item
      }
    </card-search>
  </script>

  <script>
    riot.mount('*')
  </script>

</body>
</html>
